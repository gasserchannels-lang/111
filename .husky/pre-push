#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Run PHPStan
echo "ğŸ“Š Running PHPStan static analysis..."
./vendor/bin/phpstan analyse --memory-limit=2G
if [ $? -ne 0 ]; then
    echo "âŒ PHPStan failed. Please fix the issues before pushing."
    exit 1
fi

# Run PHPUnit tests
echo "ğŸ§ª Running PHPUnit tests..."
./vendor/bin/phpunit --configuration=phpunit.xml
if [ $? -ne 0 ]; then
    echo "âŒ Tests failed. Please fix the failing tests before pushing."
    exit 1
fi

# Run Laravel Pint
echo "ğŸ¨ Running Laravel Pint code style check..."
./vendor/bin/pint --test
if [ $? -ne 0 ]; then
    echo "âŒ Code style issues found. Please run './vendor/bin/pint' to fix them."
    exit 1
fi

# Run PHPMD
echo "ğŸ” Running PHPMD code quality check..."
./vendor/bin/phpmd app,config,database,routes text phpmd.xml
if [ $? -ne 0 ]; then
    echo "âŒ PHPMD found code quality issues. Please review and fix them."
    exit 1
fi

# Run Composer Audit
echo "ğŸ”’ Running Composer security audit..."
composer audit
if [ $? -ne 0 ]; then
    echo "âŒ Security vulnerabilities found. Please update dependencies."
    exit 1
fi

echo "âœ… All pre-push checks passed! Ready to push."
